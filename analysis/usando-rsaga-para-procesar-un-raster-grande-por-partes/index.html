

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Usando RSAGA para procesar un raster grande por partes - Benito Zaragozí</title>







<meta property="og:locale" content="en">
<meta property="og:site_name" content="Benito Zaragozí">
<meta property="og:title" content="Usando RSAGA para procesar un raster grande por partes">




  <meta property="og:description" content="Viejo post sobre automatizar el recorte de un raster con R y SAGA GIS">



  <meta name="twitter:site" content="@benizar81">
  <meta name="twitter:title" content="Usando RSAGA para procesar un raster grande por partes">
  <meta name="twitter:description" content="Viejo post sobre automatizar el recorte de un raster con R y SAGA GIS">
  <meta name="twitter:url" content="">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2011-01-13T00:00:00+00:00">
  
    <link rel="next" href="/protip/business-card-de-gischips-en-latex-3/" title="Business card de GISchips (en LaTeX)">
  
  
    <link rel="prev" href="/programming/la-ciencia-de-los-suelos-i-creacion-de-triangulos-texturales-directamente-desde-una-geodatabase/" title="La ciencia de los suelos (I). Creación de triángulos texturales directamente desde una Geodatabase.">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Benito Zaragozí",
      "url" : null,
      "sameAs" : ["https://twitter.com/benizar81","https://facebook.com/benizar81","https://www.linkedin.com/in/benizar","https://www.researchgate.net/profile/Benito_Zaragozi","http://orcid.org/0000-0003-2501-484X"]
    }
  </script>






<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Benito Zaragozí Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/academicons.min.css"/>

<meta http-equiv="cleartype" content="on">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="/">Benito Zaragozí</a></li>
          
            
            <li class="masthead__menu-item"><a href="/year-archive/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="/cv/">CV</a></li>
          
            
            <li class="masthead__menu-item"><a href="/publications/">Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="/contact/">Contact</a></li>
          
            
            <li class="masthead__menu-item"><a href="/about/">About me</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="/images/benizar-photo.jpg" class="author__avatar" alt="Benito Zaragozí">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Benito Zaragozí</h3>
    <p class="author__bio">Geographer and GIScientist</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Vila-Seca, Spain</li>
      
      
      
        <li><a href="mailto:benizar@gmail.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      

      
        <li><a href="https://orcid.org/0000-0003-2501-484X"><i class="ai ai-fw ai-orcid" aria-hidden="true" style="color:#a6ce39ff;"></i>ORCID</a></li>
      
      
        <li><a href="http://www.researcherid.com/rid/B-5270-2019"><i class="ai ai-fw ai-researcherid" aria-hidden="true" style="color:#ffa500;"></i>ResearcherID</a></li>
      
      
        <li><a href="https://scholar.google.es/citations?user=sO9xAc8AAAAJ"><i class="ai ai-fw ai-google-scholar-square" aria-hidden="true"  style="color:#508ef3ff;"></i>Google Scholar</a></li>
      
      
        <li><a href="https://www.researchgate.net/profile/Benito_Zaragozi"><i class="ai ai-fw ai-researchgate-square" aria-hidden="true" style="color:#00e3abff;"></i>ResearchGate</a></li>
      
      
        <li><a href="https://www.mendeley.com/profiles/benito-zaragozi"><i class="ai ai-fw ai-mendeley-square" aria-hidden="true" style="color:#a51925ff;"></i>Mendeley</a></li>
      

      
        <li><a href="https://bitbucket.org/benizar"><i class="fa fa-fw fa-bitbucket" aria-hidden="true"></i> Bitbucket</a></li>
      
      
        <li><a href="https://github.com/benizar"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      


      
        <li><a href="https://www.linkedin.com/in/benizar"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      

      
        <li><a href="https://twitter.com/benizar81"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
        <li><a href="https://www.facebook.com/benizar81"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
      


      
      
      


      
      
      
      


      
      
      
      
      
      
      
      
      
      

    </ul>
  </div>
</div>


  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Usando RSAGA para procesar un raster grande por partes">
    <meta itemprop="description" content="Viejo post sobre automatizar el recorte de un raster con R y SAGA GIS">
    <meta itemprop="datePublished" content="January 13, 2011">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Usando RSAGA para procesar un raster <em>grande</em> por partes
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p class="notice--info"><strong>Nota:</strong> Este es un viejo post que he recuperado del blog de GIS&amp;Chips. Me gustaría encontrar tiempo para explorar el uso de otras librerías GIS desde R.</p>

<p>Hola a todos, hoy propongo una de las posibles soluciones a un problema que suele aparecer trabajando con GIS: ¿qué hacer cuando queremos procesar un raster “relativamente grande” y los GIS de escritorio más populares tienen problemas de memoria o no acaban el proceso?</p>

<p>En algunas ocasiones la solución a estos problemas sería “trocear” el raster y procesarlo por partes. Esto lo podríamos hacer con varios software y en todos ellos sería interesante poder automatizar la tarea al máximo.</p>

<figure class="half">
	<a href="/images/mb-mdt.jpg"><img src="/images/mb-mdt.jpg" /></a>
	<a href="/images/mb-municipalities.jpg"><img src="/images/mb-municipalities.jpg" /></a>
	<figcaption>(1) Modelo digital raster y (2) Shapefile de polígonos con que trocearemos el raster.</figcaption>
</figure>

<p>En este post propongo realizar una prueba con RSAGA, que es un modulo de R que permite acceder a las funciones disponibles en la consola de SAGA GIS. Para este post he trabajado en Windows, con R 2.10.1 y SAGA 2.0.4, aunque supongo que no habrá problemas con usar otras versiones más recientes. Además, deberéis instalar en R el paquete RSAGA.</p>

<p>Para esta práctica podéis <a href="/downloads/rsaga_tests.rar">descargar ficheros de prueba</a> (imágenes 1 y 2), uno raster y otro vectorial (polígonos). A efectos didácticos se utilizan ficheros pequeños, pero esto resultaría más útil en caso de necesitar fragmentar más el raster. Por ejemplo, en artículos anteriores he presentado código para trabajar imágenes a nivel de parcelas agrícolas. En aquellos artículos trabajábamos las imágenes de una en una y ya estaban recortadas, pero las parcelas podrían ser miles y no queremos hacer eso a mano.</p>

<h2 id="conociendo-saga-gis">Conociendo SAGA GIS</h2>

<p>Lo principal, como en tantos otros casos, sería conocer como se trocea un fichero raster con SAGA GIS. Para ello abrimos la GUI de SAGA y vamos a la pestaña “modules” que tiene forma de TOC, generalmente se encuentra a la izquierda de la ventana principal. En esta pestaña podemos encontrar las distintas librerías que agrupan módulos que se relacionan por algún motivo. Explorar estas librerías y practicar con ellas es el mejor modo de estar seguro de lo que se quiere hacer.</p>

<figure class="third">
	<a href="/images/saga-gis-toc.jpg"><img src="/images/saga-gis-toc.jpg" /></a>
	<figcaption>Figura 3. TOC de SAGA GIS donde podemos explorar las librerías y los módulos disponibles.</figcaption>
</figure>

<p>Finalmente, he decidido que lo mejor es empezar por separar el shapefile original por polígonos (shapes-tools/separate shapes) y después realizar un recorte por cada uno de los nuevos shapefiles (shapes-grid/clip grid with polygon). Practicar con el interfaz gráfico es un bueno modo de estar seguros de los parámetros que nos pide cada módulo.</p>

<p>Antes de empezar a usar RSAGA he tenido que averiguar los nombres exactos de los módulos y los parámetros que aceptan. Esto lo he hecho con los métodos <code class="highlighter-rouge">rsaga.get.modules()</code> y <code class="highlighter-rouge">rsaga.get.usage()</code>. Aunque generalmente se puede averiguar también viendo los nombres en el SAGA GUI o mirando en la carpeta donde se contienen las *.dll.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">## Abrimos la consola de R y cargamos la librería
</span><span class="n">library</span><span class="p">(</span><span class="n">RSAGA</span><span class="p">)</span><span class="w">

</span><span class="c1">## Seleccionamos el fichero raster que queremos trocear y una capa vectorial que queramos usar como límites. También especificamos el directorio donde van los outputs. Para trabajar con Windows recomiendo rutas sin espacios.
</span><span class="n">raster</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.choose</span><span class="p">()</span><span class="w">
</span><span class="n">poligonos</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.choose</span><span class="p">()</span><span class="w">
</span><span class="n">directorio</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">choose.dir</span><span class="p">()</span><span class="w">

</span><span class="c1">## Consultamos hasta encontrar la herramienta que nos separa un shapefile en varios, obteniendo un shapefile por cada polígono, o lo que quisiéramos. Por ejemplo:
## rsaga.get.modules("shapes_grid")
## rsaga.get.usage("shapes_tools", 7)
## Se ejecuta el método con los parámetros necesarios.
</span><span class="n">rsaga.geoprocessor</span><span class="p">(</span><span class="n">lib</span><span class="o">=</span><span class="s2">"shapes_tools"</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">param</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">SHAPES</span><span class="o">=</span><span class="n">poligonos</span><span class="p">,</span><span class="w"> </span><span class="n">PATH</span><span class="o">=</span><span class="n">directorio</span><span class="p">,</span><span class="w"> </span><span class="n">NAMING</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">FIELD</span><span class="o">=</span><span class="m">6</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Una vez ejecutado este proceso ya disponemos de un shapefile por cada polígono, esto significa que aunque el shapefile original tuviera miles de registros solamente cargaremos en memoria uno a la vez. Esto ya supone un ahorro importante de recursos.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># Listamos los nuevos shapefiles
</span><span class="n">shapefiles</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">directorio</span><span class="p">,</span><span class="w"> </span><span class="n">full.names</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="o">=</span><span class="s2">"\\.shp"</span><span class="p">)</span><span class="w">
</span><span class="c1">## Por último utilizamos RSAGA para realizar tantos recortes del raster como polígonos habíamos extraído
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">shapefiles</span><span class="p">)){</span><span class="w">
</span><span class="n">select</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shapefiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="n">rsaga.geoprocessor</span><span class="p">(</span><span class="n">lib</span><span class="o">=</span><span class="s2">"shapes_grid"</span><span class="p">,</span><span class="w"> </span><span class="n">module</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">param</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">OUTPUT</span><span class="o">=</span><span class="n">select</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="o">=</span><span class="n">raster</span><span class="p">,</span><span class="w"> </span><span class="n">POLYGONS</span><span class="o">=</span><span class="n">select</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="c1">#fin bucle
</span></code></pre>
</div>

<h2 id="conclusiones">Conclusiones</h2>

<p>Tras ver este ejemplo nos queda más claro el uso de RSAGA y se visualiza bien como se podrían automatizar gran número de tareas habituales en los GIS. Intentar realizar estas tareas herramientas básicas y generales podría ser algo trabajoso.</p>

<p>En nuestro fichero de prácticas había 18 polígonos por lo que nuestro resultado es una carpeta donde encontramos guardados 18 shapefiles y 18 ficheros raster. Los recortes quedan como se puede ver en la siguiente imagen:</p>

<figure class="half">
	<a href="/images/mb-mdt-clip.jpg"><img src="/images/mb-mdt-clip.jpg" /></a>
	<figcaption>Figura 4. Uno de los 18 raster resultantes de los recortes y al fondo el shapefile original.</figcaption>
</figure>

<p>En caso de ser necesario, se podría realizar más tareas sobre todos estos ficheros, con este software o con otros programas. Incluso se plantea la posibilidad de usar multithreading en R para ejecutar tareas con RSAGA. Proximamente haremos alguna demostración de esto.</p>

<p>Antes de acabar, solo quiero recordar quando trabajamos con RSAGA en Windows es posible que nos afecten algunas particularidades sobre el modo en que se forman las rutas (espacios, barras de directorios…) y los mensajes de error que aparecen no son de gran ayuda.</p>


        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#geobia" class="page__taxonomy-item" rel="tag">GEOBIA</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#gis" class="page__taxonomy-item" rel="tag">GIS</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#r" class="page__taxonomy-item" rel="tag">R</a>
    
    </span>
  </p>




  






  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#analysis" class="page__taxonomy-item" rel="tag">Analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2011-01-13T00:00:00+00:00">January 13, 2011</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=/analysis/usando-rsaga-para-procesar-un-raster-grande-por-partes/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=/analysis/usando-rsaga-para-procesar-un-raster-grande-por-partes/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=/analysis/usando-rsaga-para-procesar-un-raster-grande-por-partes/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=/analysis/usando-rsaga-para-procesar-un-raster-grande-por-partes/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="/programming/la-ciencia-de-los-suelos-i-creacion-de-triangulos-texturales-directamente-desde-una-geodatabase/" class="pagination--pager" title="La ciencia de los suelos (I). Creación de triángulos texturales directamente desde una Geodatabase.
">Previous</a>
    
    
      <a href="/protip/business-card-de-gischips-en-latex-3/" class="pagination--pager" title="Business card de GISchips (en LaTeX)
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  
    <a href="/programming/data%20management/group-zipping-gis-files-made-easy/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Group zipping GIS Files made easy
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  8 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">If you work with Geographic Information System (GIS) data, you’re likely familiar with multi-file formats such as ESRI Shapefiles or SAGA GIS raster files. T...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="/management/ubuntu20-dni-electronico-y-autofirma/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">DNI electrónico y autofirma en 2020: cómo NO perder 2 horas para firmar una solicitud
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Cómo usar el DNIe desde Ubuntu para firmar electrónicamente trámites en línea. En este caso se firmaron las solicitudes para optar a las certificaciones de l...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="/analysis/how-to-cite-geospatial-standards-and-other-things/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">How to cite geospatial standards and other GIS things
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">I found a template for manging ISO and OGC standards as Bibtex entries. This may be useful for citing documents that are not indexed by Google Scholar or if ...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="/multimedia/choosing-a-desktop-marker-app-for-ubuntu-18.04-lts/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Choosing a desktop marker app for Ubuntu 18.04 LTS
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  5 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">In this post I explain the main features of two desktop bookmarking apps in Ubuntu 18.04: Pylote and Gromit-MPX. Both tools come in handy when making present...</p>
    </article>
  </a>
</div>
        
      </div>
    </div>
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/benizar81"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
      <li><a href="https://facebook.com/benizar81"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
    
    
      <li><a href="http://github.com/benizar"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
      <li><a href="http://bitbucket.org/benizar"><i class="fa fa-fw fa-bitbucket" aria-hidden="true"></i> Bitbucket</a></li>
    
    <li><a href="/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Benito Zaragozí. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>









  </body>
</html>

